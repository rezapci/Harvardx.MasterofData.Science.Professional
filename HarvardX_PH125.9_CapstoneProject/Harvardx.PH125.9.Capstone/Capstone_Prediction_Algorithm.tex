\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[left=1.5cm, right=1.5cm, top=1.8cm, bottom=1.8cm]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Capstone Project - MovieLens},
            pdfauthor={Reza Hashemi},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\newenvironment{Shaded}{}{}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{#1}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\providecommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{Capstone Project - MovieLens}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
  \subtitle{Recommendation System}
  \author{Reza Hashemi}
    \preauthor{\centering\large\emph}
  \postauthor{\par}
      \predate{\centering\large\emph}
  \postdate{\par}
    \date{August 11, 2019}

\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}

\usepackage{float}

\begin{document}
\maketitle
\begin{abstract}
This report is part of the final project capstone to obtain the
`Professional Certificate in Master of Data Science' emited by Harvard
University Harvard, through edx platform for education and learning..
The main objective is to create a recommendatin system using the
MovieLens dataset, and it must be done training a machine learning
algorithm using the inputs in one subset to predict movie ratings in the
validation set.
\end{abstract}

{
\setcounter{tocdepth}{3}
\tableofcontents
}
\pagebreak

\hypertarget{executive-summary}{%
\section{Executive Summary}\label{executive-summary}}

The main purpose of this project is to develop a machine learning
algorithm for a movie recommendation system using the MovieLens dataset,
in order of predict movie ratings. The entire dataframe can be found at
\href{https://grouplens.org/datasets/movielens/latest/}{here}, but has
been used the 10M version of the
\href{http://grouplens.org/datasets/movielens/10m/}{MovieLens dataset}
to make the computation a little easier.

The recommendation system will be created using all the tools learned
throughout the courses in this series. I applied different
dimensionality reduction algorithms: Matrix Factorization and
Neighborhood Approach. It can be used to predit the rating of a user
baed on an unrated movie. \textbf{RMSE} (Root-Mean-Squared-Error) has
been applied as the evaluating criteria to analize the algorithm's
performance. The principle used for this project is based on this
definition of ``recommender system'':

\begin{quote}
\emph{A recommender system or a recommendation system (sometimes
replacing ``system'' with a synonym such as platform or engine) is a
subclass of information filtering system that seeks to predict the
``rating'' or ``preference'' a user would give to an item.}
\href{https://en.wikipedia.org/wiki/Recommender_system}{Recommender
System Definition}.
\end{quote}

This project could be the base to develop something simmilar to Amazon
or Netflix recommendation systems, because a solution like this take
users rating and use this information to predict a customer's rating, in
order to anticipate the needs of a customer.

\hypertarget{introduction}{%
\section{Introduction}\label{introduction}}

The \href{https://grouplens.org/datasets/movielens/10m/}{10M version of
the MovieLens dataset} has been used to make the computation a little
easier.

\hypertarget{selected-data}{%
\subsection{Selected Data}\label{selected-data}}

This dataset contains different users' ratings for different movies
(rating score between 1 and 5).

\begin{table}[!h]

\caption{\label{tab:edx.test.training.test}Amount of Users and Movies}
\centering
\begin{tabular}{rr}
\toprule
Users & Movies\\
\midrule
\rowcolor{gray!6}  69878 & 10677\\
\bottomrule
\end{tabular}
\end{table}

\pagebreak

\hypertarget{rmse}{%
\section{RMSE}\label{rmse}}

The RMSE (Root Mean Squared Errors) will be used to measure que
algorithms quality, and the algorithm qualification will be assigned
accordign to the next table:

\begin{table}[!h]

\caption{\label{tab:rmse.table}RMSE Valoration}
\centering
\begin{tabular}{ll}
\toprule
Points & RMSE\\
\midrule
\rowcolor{gray!6}  0 & No RMSE reported\\
5 & RMSE >= 0.90000\\
\rowcolor{gray!6}  10 & 0.88000 <= RMSE <= 0.89999\\
15 & 0.87917 <= RMSE <= 0.87999\\
\rowcolor{gray!6}  20 & 0.87751 <= RMSE <= 0.87916\\
\addlinespace
25 & RMSE <= 0.87750\\
\bottomrule
\end{tabular}
\end{table}

\begin{quote}
The goal of this project is to obtain the lowest possible RMSE, because
a RMSE is a measurement of error, and the smaller the error, the better.
\end{quote}

And, the function used to calculate the RMSE is:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# The RMSE function that will be used in this project is:}
\NormalTok{RMSE <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(}\DataTypeTok{true_ratings =} \OtherTok{NULL}\NormalTok{, }\DataTypeTok{predicted_ratings =} \OtherTok{NULL}\NormalTok{) \{}
    \KeywordTok{sqrt}\NormalTok{(}\KeywordTok{mean}\NormalTok{((true_ratings }\OperatorTok{-}\StringTok{ }\NormalTok{predicted_ratings)}\OperatorTok{^}\DecValTok{2}\NormalTok{))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

The RMSE formula is: \textbf{RMSE} =
\(\sqrt{\frac{\sum_{i=1}^N (Predicted_i - Actual_i)^2}{N}}\)

\begin{table}[!h]

\caption{\label{tab:rmse.formula}RMSE Formula Values Definition}
\centering
\begin{tabular}{ll}
\toprule
Variable & Definition\\
\midrule
\rowcolor{gray!6}  N & Number of Samples\\
Predicted & Forecasts\\
\rowcolor{gray!6}  Actual & Observed Values\\
\bottomrule
\end{tabular}
\end{table}

\pagebreak

\hypertarget{data-preparation-and-preprocessing}{%
\section{Data Preparation and
Preprocessing}\label{data-preparation-and-preprocessing}}

\hypertarget{data-exploration}{%
\subsection{Data Exploration}\label{data-exploration}}

The \href{https://grouplens.org/datasets/movielens/10m/}{MovieLens 10M
dataset}, contains \textcolor{red}{23369607} rows and
\textcolor{red}{10} columns, with column names:
\textcolor{red}{userId, movieId, rating, timestamp, title, genres, dates, date.year, date.year.month, date.year.month.day},
and the dataset structure is:

\tiny

\begin{verbatim}
## 'data.frame':    23369607 obs. of  10 variables:
##  $ userId             : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ movieId            : int  122 122 185 185 185 231 292 292 292 292 ...
##  $ rating             : num  5 5 5 5 5 5 5 5 5 5 ...
##  $ timestamp          : int  838985046 838985046 838983525 838983525 838983525 838983392 838983421 838983421 838983421 838983421 ...
##  $ title              : Factor w/ 10676 levels "'burbs, The (1989)",..: 1309 1309 6758 6758 6758 2871 7179 7179 7179 7179 ...
##  $ genres             : Factor w/ 20 levels "(no genres listed)",..: 6 16 2 7 18 6 2 9 17 18 ...
##  $ dates              : Factor w/ 6520453 levels "1995-01-09 06:46:49",..: 218509 218509 218465 218465 218465 218452 218454 218454 218454 218454 ...
##  $ date.year          : int  1996 1996 1996 1996 1996 1996 1996 1996 1996 1996 ...
##  $ date.year.month    : Factor w/ 157 levels "1995-01","1996-01",..: 9 9 9 9 9 9 9 9 9 9 ...
##  $ date.year.month.day: Factor w/ 4640 levels "1995-01-09","1996-01-29",..: 170 170 170 170 170 170 170 170 170 170 ...
\end{verbatim}

\normalsize

\hypertarget{datalens-data-analysis}{%
\subsection{DataLens Data Analysis}\label{datalens-data-analysis}}

The \textcolor{red}{`10 first rows`} of
\textcolor{red}{`DataLens dataset`} are:\\
\tiny

\begin{table}[!h]

\caption{\label{tab:edx.test.head}First 10 Rows}
\centering
\resizebox{\linewidth}{!}{
\begin{tabular}{rrrrlllrll}
\toprule
userId & movieId & rating & timestamp & title & genres & dates & date.year & date.year.month & date.year.month.day\\
\midrule
\rowcolor{gray!6}  1 & 122 & 5 & 838985046 & Boomerang (1992) & Comedy & 1996-08-02 07:24:06 & 1996 & 1996-08 & 1996-08-02\\
1 & 122 & 5 & 838985046 & Boomerang (1992) & Romance & 1996-08-02 07:24:06 & 1996 & 1996-08 & 1996-08-02\\
\rowcolor{gray!6}  1 & 185 & 5 & 838983525 & Net, The (1995) & Action & 1996-08-02 06:58:45 & 1996 & 1996-08 & 1996-08-02\\
1 & 185 & 5 & 838983525 & Net, The (1995) & Crime & 1996-08-02 06:58:45 & 1996 & 1996-08 & 1996-08-02\\
\rowcolor{gray!6}  1 & 185 & 5 & 838983525 & Net, The (1995) & Thriller & 1996-08-02 06:58:45 & 1996 & 1996-08 & 1996-08-02\\
\addlinespace
1 & 231 & 5 & 838983392 & Dumb \& Dumber (1994) & Comedy & 1996-08-02 06:56:32 & 1996 & 1996-08 & 1996-08-02\\
\rowcolor{gray!6}  1 & 292 & 5 & 838983421 & Outbreak (1995) & Action & 1996-08-02 06:57:01 & 1996 & 1996-08 & 1996-08-02\\
1 & 292 & 5 & 838983421 & Outbreak (1995) & Drama & 1996-08-02 06:57:01 & 1996 & 1996-08 & 1996-08-02\\
\rowcolor{gray!6}  1 & 292 & 5 & 838983421 & Outbreak (1995) & Sci-Fi & 1996-08-02 06:57:01 & 1996 & 1996-08 & 1996-08-02\\
1 & 292 & 5 & 838983421 & Outbreak (1995) & Thriller & 1996-08-02 06:57:01 & 1996 & 1996-08 & 1996-08-02\\
\bottomrule
\end{tabular}}
\end{table}

\normalsize

And, a more detailed information of \textcolor{red}{`DataLens Dataset`}
is:\\
\small

\begin{verbatim}
##      userId         movieId          rating        timestamp        
##  Min.   :    1   Min.   :    1   Min.   :0.500   Min.   :7.897e+08  
##  1st Qu.:18141   1st Qu.:  616   1st Qu.:3.000   1st Qu.:9.472e+08  
##  Median :35790   Median : 1748   Median :4.000   Median :1.042e+09  
##  Mean   :35887   Mean   : 4276   Mean   :3.527   Mean   :1.035e+09  
##  3rd Qu.:53635   3rd Qu.: 3635   3rd Qu.:4.000   3rd Qu.:1.131e+09  
##  Max.   :71567   Max.   :65133   Max.   :5.000   Max.   :1.231e+09  
##                                                                     
##                   title                genres       
##  Forrest Gump (1994) :  124304   Drama    :3909401  
##  Toy Story (1995)    :  119130   Comedy   :3541284  
##  Jurassic Park (1993):  117164   Action   :2560649  
##  True Lies (1994)    :  113930   Thriller :2325349  
##  Aladdin (1992)      :  106070   Adventure:1908692  
##  Batman (1989)       :   97372   Romance  :1712232  
##  (Other)             :22691637   (Other)  :7412000  
##                  dates            date.year    date.year.month   
##  1996-02-29 19:00:00:     873   Min.   :1995   1999-12:  684022  
##  2005-07-26 15:24:47:     127   1st Qu.:2000   2000-11:  616704  
##  1996-03-29 12:04:19:     102   Median :2003   1999-10:  528315  
##  1996-04-07 06:40:52:     100   Mean   :2002   2005-03:  526641  
##  1996-04-15 06:23:54:     100   3rd Qu.:2005   1996-06:  389438  
##  1996-04-01 07:03:49:      99   Max.   :2009   1999-11:  363899  
##  (Other)            :23368206                  (Other):20260588  
##  date.year.month.day  
##  2000-11-20:  142846  
##  2005-03-22:  116917  
##  1999-12-11:  107247  
##  2008-10-29:   93590  
##  2000-11-21:   82659  
##  1999-12-12:   79062  
##  (Other)   :22747286
\end{verbatim}

\pagebreak   
\normalsize

\hypertarget{visualize-the-importance-of-variables}{%
\section{Visualize the Importance of
Variables}\label{visualize-the-importance-of-variables}}

\hypertarget{all-data}{%
\subsection{All Data}\label{all-data}}

Each variable and its amount in the data set is:\\
\textcolor{blue}{<Dates are grouped by month>}

In the table we can see the total amount of each field in the dataset:

\begin{table}[!h]

\caption{\label{tab:movies.users.genres.list}Total Amount of each Field}
\centering
\begin{tabular}{lr}
\toprule
Field & Amount\\
\midrule
\rowcolor{gray!6}  Dates - Year & 15\\
Dates - Month & 157\\
\rowcolor{gray!6}  Genres & 20\\
Ratings & 10\\
\rowcolor{gray!6}  Titles & 10676\\
\addlinespace
Users & 69878\\
\bottomrule
\end{tabular}
\end{table}

\hypertarget{analysis-by-date-timestamp}{%
\subsection{Analysis by Date
(timestamp)}\label{analysis-by-date-timestamp}}

The dataset contains information of \textcolor{red}{15} years, since:
\textcolor{red}{1995} to \textcolor{red}{2010}. And, we can see the
behavior of ratings over the years:

\begin{verbatim}
## Bar Graph
\end{verbatim}

\begin{center}\includegraphics{img/table.ratings.years-1} \end{center}

An evaluation of ratings per year won't let us to identify the year with
most ratings amount, because the behavior was irregular.

And, an evaluation of genres rating over the years:

\begin{verbatim}
## Col Graph
\end{verbatim}

\begin{center}\includegraphics{img/rable.ratings.years.genres-1} \end{center}

Users by year:

\begin{verbatim}
## Bar Graph
\end{verbatim}

\begin{center}\includegraphics{img/unnamed-chunk-1-1} \end{center}

It won't be useful to add date into overall prediction, as result of the
analysis of previous graphics, in which we can see that the year does
not represent an evident influence over the ratings, but nevertheless,
if we make an evaluation of successful movies on each year, it could be
a point of analysis. But, this is not the case.

\hypertarget{analysis-by-genres}{%
\subsection{Analysis by Genres}\label{analysis-by-genres}}

After separating all genres in the Data, we have obtained a total of
\textcolor{red}{20} different genres, the following table shows the
genres list and the amount of times that each one appear on data:

Amount of movies per genres:

\begin{verbatim}
## Descendent order
\end{verbatim}

\begin{table}[!h]

\caption{\label{tab:genres.list}Top 10 Genres}
\centering
\begin{tabular}{lr}
\toprule
genres & count\\
\midrule
\rowcolor{gray!6}  Drama & 3909401\\
Comedy & 3541284\\
\rowcolor{gray!6}  Action & 2560649\\
Thriller & 2325349\\
\rowcolor{gray!6}  Adventure & 1908692\\
\addlinespace
Romance & 1712232\\
\rowcolor{gray!6}  Sci-Fi & 1341750\\
Crime & 1326917\\
\rowcolor{gray!6}  Fantasy & 925624\\
Children & 737851\\
\bottomrule
\end{tabular}
\end{table}

Drama, Comedy, Action, and Thriller are the most likely rated, which
movies are the most rated?

\begin{verbatim}
## Descendent order
\end{verbatim}

\begin{table}[!h]

\caption{\label{tab:movies.top.10}Top 10 Rated Movies}
\centering
\begin{tabular}{llr}
\toprule
genres & title & count\\
\midrule
\rowcolor{gray!6}  Comedy & Pulp Fiction (1994) & 31336\\
Crime & Pulp Fiction (1994) & 31336\\
\rowcolor{gray!6}  Drama & Pulp Fiction (1994) & 31336\\
Comedy & Forrest Gump (1994) & 31076\\
\rowcolor{gray!6}  Drama & Forrest Gump (1994) & 31076\\
\addlinespace
Romance & Forrest Gump (1994) & 31076\\
\rowcolor{gray!6}  War & Forrest Gump (1994) & 31076\\
Crime & Silence of the Lambs, The (1991) & 30280\\
\rowcolor{gray!6}  Horror & Silence of the Lambs, The (1991) & 30280\\
Thriller & Silence of the Lambs, The (1991) & 30280\\
\bottomrule
\end{tabular}
\end{table}

The amount of movies per rating:

\begin{table}[!h]

\caption{\label{tab:movies.per.rating}Amount of Movies per Rating, with Different ID}
\centering
\begin{tabular}{rr}
\toprule
rating & movies\\
\midrule
\rowcolor{gray!6}  3.0 & 10216\\
4.0 & 9954\\
\rowcolor{gray!6}  3.5 & 9810\\
2.0 & 9458\\
\rowcolor{gray!6}  2.5 & 9416\\
\addlinespace
5.0 & 8618\\
\rowcolor{gray!6}  4.5 & 8299\\
1.0 & 8278\\
\rowcolor{gray!6}  0.5 & 7197\\
1.5 & 7069\\
\bottomrule
\end{tabular}
\end{table}

Graph of Number of Movies Vs Number of Ratings:

\begin{center}\includegraphics{img/graph.movies.vs.ratings-1} \end{center}

\hypertarget{analysis-by-rating-year}{%
\subsection{Analysis by Rating \& Year}\label{analysis-by-rating-year}}

Most rated year: \textcolor{red}{2000, 1144666}\\
Less rated year: \textcolor{red}{1995, 2}

\begin{table}[!h]

\caption{\label{tab:table.rated.year}Rating Per Year}
\centering
\begin{tabular}{rr}
\toprule
date.year & ratings\\
\midrule
\rowcolor{gray!6}  1995 & 2\\
1996 & 942976\\
\rowcolor{gray!6}  1997 & 414218\\
1998 & 181845\\
\rowcolor{gray!6}  1999 & 709978\\
\addlinespace
2000 & 1144666\\
\rowcolor{gray!6}  2001 & 683412\\
2002 & 524826\\
\rowcolor{gray!6}  2003 & 619707\\
2004 & 691191\\
\addlinespace
\rowcolor{gray!6}  2005 & 1059807\\
2006 & 689447\\
\rowcolor{gray!6}  2007 & 628845\\
2008 & 696027\\
\rowcolor{gray!6}  2009 & 13114\\
\bottomrule
\end{tabular}
\end{table}

The graph of ratings by year is:

\begin{verbatim}
## Bar Graph Color
\end{verbatim}

\begin{center}\includegraphics{img/graph.rating.year-1} \end{center}

\hypertarget{analysis-by-rating-movie}{%
\subsection{Analysis by Rating \&
Movie}\label{analysis-by-rating-movie}}

The most rated movie is: \textcolor{red}{7671, 31336}\\
The less rated movie is: \textcolor{red}{20, 1}

\begin{table}[!h]

\caption{\label{tab:table.rating.movie}Ratings per Movie}
\centering
\begin{tabular}{lr}
\toprule
title & ratings\\
\midrule
\rowcolor{gray!6}  Pulp Fiction (1994) & 31336\\
Forrest Gump (1994) & 31076\\
\rowcolor{gray!6}  Silence of the Lambs, The (1991) & 30280\\
Jurassic Park (1993) & 29291\\
\rowcolor{gray!6}  Shawshank Redemption, The (1994) & 27988\\
\addlinespace
Braveheart (1995) & 26258\\
\rowcolor{gray!6}  Terminator 2: Judgment Day (1991) & 26115\\
Fugitive, The (1993) & 26050\\
\rowcolor{gray!6}  Star Wars: Episode IV - A New Hope (a.k.a. Star Wars) (1977) & 25809\\
Batman (1989) & 24343\\
\bottomrule
\end{tabular}
\end{table}

The graph of ratings by movie is:\\
\tiny

\begin{verbatim}
## Bar Graph Color
\end{verbatim}

\begin{center}\includegraphics{img/graph.rating.movie-1} \end{center}
\normalsize

\hypertarget{analysis-by-rating-genre}{%
\subsection{Analysis by Rating \&
Genre}\label{analysis-by-rating-genre}}

The most rated genre: \textcolor{red}{9, 3909401}\\
The less rated genre: \textcolor{red}{1, 6}

\begin{table}[!h]

\caption{\label{tab:table.rating.genre}Ratings per Genre}
\centering
\begin{tabular}{lr}
\toprule
genres & ratings\\
\midrule
\rowcolor{gray!6}  Drama & 3909401\\
Comedy & 3541284\\
\rowcolor{gray!6}  Action & 2560649\\
Thriller & 2325349\\
\rowcolor{gray!6}  Adventure & 1908692\\
\addlinespace
Romance & 1712232\\
\rowcolor{gray!6}  Sci-Fi & 1341750\\
Crime & 1326917\\
\rowcolor{gray!6}  Fantasy & 925624\\
Children & 737851\\
\addlinespace
\rowcolor{gray!6}  Horror & 691407\\
Mystery & 567865\\
\rowcolor{gray!6}  War & 511330\\
Animation & 467220\\
\rowcolor{gray!6}  Musical & 432960\\
\addlinespace
Western & 189234\\
\rowcolor{gray!6}  Film-Noir & 118394\\
Documentary & 93252\\
\rowcolor{gray!6}  IMAX & 8190\\
(no genres listed) & 6\\
\bottomrule
\end{tabular}
\end{table}

The graph of ratings by genre is:

\begin{verbatim}
## Bar Graph Color
\end{verbatim}

\begin{center}\includegraphics{img/graph.rating.genre-1} \end{center}

\hypertarget{analysis-of-ratings-user}{%
\subsection{Analysis of Ratings \&
User}\label{analysis-of-ratings-user}}

The most user ratings: \textcolor{red}{59269, 6637}\\
The less user ratings: \textcolor{red}{22325, 13}

\begin{table}[!h]

\caption{\label{tab:table.rating.user}Ratings per User}
\centering
\begin{tabular}{rr}
\toprule
userId & ratings\\
\midrule
\rowcolor{gray!6}  59269 & 6637\\
67385 & 6376\\
\rowcolor{gray!6}  14463 & 4637\\
68259 & 4056\\
\rowcolor{gray!6}  27468 & 4018\\
\addlinespace
19635 & 3740\\
\rowcolor{gray!6}  3817 & 3736\\
63134 & 3390\\
\rowcolor{gray!6}  58357 & 3318\\
27584 & 3139\\
\bottomrule
\end{tabular}
\end{table}

The graph of ratings by user is:

\begin{verbatim}
## Bar Graph Color
\end{verbatim}

\begin{center}\includegraphics{img/graph.rating.user-1} \end{center}

\hypertarget{analysis-by-title}{%
\subsection{Analysis by Title}\label{analysis-by-title}}

The most rated title by year:

\begin{table}[!h]

\caption{\label{tab:table.rating.title}Rating per Title}
\centering
\begin{tabular}{lr}
\toprule
title & ratings\\
\midrule
\rowcolor{gray!6}  Pulp Fiction (1994) & 31336\\
Forrest Gump (1994) & 31076\\
\rowcolor{gray!6}  Silence of the Lambs, The (1991) & 30280\\
Jurassic Park (1993) & 29291\\
\rowcolor{gray!6}  Shawshank Redemption, The (1994) & 27988\\
\addlinespace
Braveheart (1995) & 26258\\
\rowcolor{gray!6}  Terminator 2: Judgment Day (1991) & 26115\\
Fugitive, The (1993) & 26050\\
\rowcolor{gray!6}  Star Wars: Episode IV - A New Hope (a.k.a. Star Wars) (1977) & 25809\\
Batman (1989) & 24343\\
\bottomrule
\end{tabular}
\end{table}

The most rated title: \textcolor{red}{7671, 31336}\\
The less rated title: \textcolor{red}{20, 1}

Rating per title:

\begin{verbatim}
## Bar Graph Color
\end{verbatim}

\begin{center}\includegraphics{img/graph.rating.title-1} \end{center}

Most rated title per year:

\begin{table}[!h]

\caption{\label{tab:table.edx.title.year}Most Rated Title per Year}
\centering
\begin{tabular}{rlr}
\toprule
date.year & title & ratings\\
\midrule
\rowcolor{gray!6}  1995 & Fish Called Wanda, A (1988) & 1\\
1995 & Get Shorty (1995) & 1\\
\rowcolor{gray!6}  1996 & Batman (1989) & 12051\\
1997 & Independence Day (a.k.a. ID4) (1996) & 4733\\
\rowcolor{gray!6}  1998 & Titanic (1997) & 934\\
\addlinespace
1999 & Star Wars: Episode V - The Empire Strikes Back (1980) & 2609\\
\rowcolor{gray!6}  2000 & American Beauty (1999) & 3789\\
2001 & Crouching Tiger, Hidden Dragon (Wu hu zang long) (2000) & 2440\\
\rowcolor{gray!6}  2002 & Lord of the Rings: The Fellowship of the Ring, The (2001) & 1996\\
2003 & Lord of the Rings: The Two Towers, The (2002) & 2176\\
\addlinespace
\rowcolor{gray!6}  2004 & Lord of the Rings: The Return of the King, The (2003) & 2163\\
2005 & Lord of the Rings: The Two Towers, The (2002) & 3245\\
\rowcolor{gray!6}  2006 & Lord of the Rings: The Return of the King, The (2003) & 2079\\
2007 & Forrest Gump (1994) & 1970\\
\rowcolor{gray!6}  2008 & Matrix, The (1999) & 2485\\
\addlinespace
2009 & Dark Knight, The (2008) & 71\\
\bottomrule
\end{tabular}
\end{table}

\tiny

\begin{verbatim}
## Bar Graph Color
\end{verbatim}

\begin{center}\includegraphics{img/graph.rating.title.year-1} \end{center}
\normalsize

\hypertarget{analysis-by-users}{%
\subsection{Analysis by Users}\label{analysis-by-users}}

A table of user with more ratings:

\begin{table}[!h]

\caption{\label{tab:table.rating.user.show}Ratings per Rating Value}
\centering
\begin{tabular}{rrr}
\toprule
rating & ratings & percent\\
\midrule
\rowcolor{gray!6}  4.0 & 6730156 & 28.7987556\\
3.0 & 5466754 & 23.3925799\\
\rowcolor{gray!6}  5.0 & 3639299 & 15.5727865\\
3.5 & 2112391 & 9.0390523\\
\rowcolor{gray!6}  2.0 & 1792891 & 7.6718920\\
\addlinespace
4.5 & 1416963 & 6.0632727\\
\rowcolor{gray!6}  2.5 & 873585 & 3.7381245\\
1.0 & 844605 & 3.6141173\\
\rowcolor{gray!6}  1.5 & 276775 & 1.1843374\\
0.5 & 216188 & 0.9250819\\
\bottomrule
\end{tabular}
\end{table}

The user with most ratings has the ID: \textcolor{red}{59269, 6637}\\
The user with less ratings has the ID: \textcolor{red}{22325, 13}

\begin{quote}
\begin{quote}
Users rated movies with 4.0 over 28\%, more than quarter of time
\end{quote}
\end{quote}

Graph of user's ratings:

\begin{center}\includegraphics{img/graph.rating.user.view-1} \end{center}

Amount of users per rating:

A table that shows all ratings per user:

\begin{table}[!h]

\caption{\label{tab:table.user.per.rating}Ratings per User}
\centering
\begin{tabular}{lr}
\toprule
userId & ratings\\
\midrule
\rowcolor{gray!6}  59269 & 13545\\
67385 & 13371\\
\rowcolor{gray!6}  14463 & 9090\\
27468 & 8920\\
\rowcolor{gray!6}  3817 & 8638\\
\addlinespace
68259 & 8636\\
\rowcolor{gray!6}  19635 & 8153\\
63134 & 7567\\
\rowcolor{gray!6}  58357 & 7542\\
6757 & 7092\\
\bottomrule
\end{tabular}
\end{table}

Graph of times that a user has rated a movie:

\begin{center}\includegraphics{img/graph.user.vs.rating-1} \end{center}

\pagebreak

\hypertarget{model-building-training}{%
\section{Model Building \& Training}\label{model-building-training}}

The model used for developing the prediction algorithm follows: the mean
rating \textcolor{red}{${\mu}$} is modified by one or more
\textcolor{red}{bias} terms \textcolor{red}{b} with a residual error
\textcolor{red}{$\epsilon$} expected.\\
\(Y{u,i} = \mu + b_{i} + b_{u} + b_{g} + \epsilon_{i,u,g}\)

Let's start writing a loss-function that computes the RMSE (Residual
Mean Squared Error), as accuracy meassure.

\hypertarget{baseline-model}{%
\subsection{Baseline Model}\label{baseline-model}}

Let's start with a baseline model, the most basic recommendation system.
This baseline includes the average of all users accross all movies and
use the average to predict all ratings:\\
\(Y_{u,i} = \mu + \epsilon_{u,i}\)

No is time to predict a new rating to be the average tating of all
movies in the training dataset, and it will be the
\textcolor{red}{`Baseline RMSE`}.\\
\textbf{mu} = \textcolor{red}{3.5270036} and baseline \textbf{RMSE} =
\textcolor{red}{1.0522745}

\begin{table}[!h]

\caption{\label{tab:table.RMSE.comparisson.baseline}RMSEs Comparisson}
\centering
\begin{tabular}{lr}
\toprule
method & RMSE\\
\midrule
\rowcolor{gray!6}  Baseline & 1.052275\\
\bottomrule
\end{tabular}
\end{table}

\hypertarget{movies-bias}{%
\subsection{Movies Bias}\label{movies-bias}}

In order of improve the model, we will analyze the movies bias effect.

In the next graph we can make a visual evaluation of
\textcolor{red}{Movies Bias}

\begin{center}\includegraphics{img/movies.bias.graph-1} \end{center}

An \texttt{lm} evaluation is not possible because the dataset is too
big, and the computer could crash by memory. The formula is:
\(Y_{u,i} = \mu + b_{i} + \epsilon_{u,i}\)

To solve the previous restriction, we can estimate the movie bias as
\(\hat{b_{i}} = y_{u,i} - \mu\) for each \texttt{i} movie. The the
equation to use is: \(\hat{y_{u,i}} = \hat{\mu} + \hat{b_{i}}\)

In this table we can see the RMSE produced by
\textcolor{red}{Movies Bias}

\begin{table}[!h]

\caption{\label{tab:movies.bias.table}RMSEs Comparisson}
\centering
\begin{tabular}{lr}
\toprule
method & RMSE\\
\midrule
\rowcolor{gray!6}  Baseline & 1.0522745\\
Movies Bias & 0.9405772\\
\bottomrule
\end{tabular}
\end{table}

We can see an improvement of \textcolor{red}{Movies Bias} over
\textcolor{red}{Baseline}.

\hypertarget{users-bias}{%
\subsection{Users Bias}\label{users-bias}}

Is time for testing the \textcolor{red}{users bias}, and evaluate the
impact over the model.

Now, is time to see the impact of \textcolor{red}{User Bias} over the
model.

\begin{table}[!h]

\caption{\label{tab:table.rmse.comparisson.user.bias}RMSEs Comparisson}
\centering
\begin{tabular}{lr}
\toprule
method & RMSE\\
\midrule
\rowcolor{gray!6}  Baseline & 1.0522745\\
Movies Bias & 0.9405772\\
\rowcolor{gray!6}  Users Bias & 0.9790470\\
\bottomrule
\end{tabular}
\end{table}

\hypertarget{movies-users-bias}{%
\subsection{Movies \& Users Bias}\label{movies-users-bias}}

The next evaluation will include the
\textcolor{red}{Movies and Users bias}.

In this analysis we will include the user effect (\(b_{u}\)).

First, we can see a graph with the users rating average:

\begin{center}\includegraphics{img/graph.movies.users.bias-1} \end{center}

We can see that most of the users have an average between 3 and 4.5, and
in the table we can see an improvement in the RMSE over the previous
calculated RMSEs.

\begin{table}[!h]

\caption{\label{tab:table.rmse.comparisson}RMSEs Comparisson}
\centering
\begin{tabular}{lr}
\toprule
method & RMSE\\
\midrule
\rowcolor{gray!6}  Baseline & 1.0522745\\
Movies Bias & 0.9405772\\
\rowcolor{gray!6}  Users Bias & 0.9790470\\
Movies \& Users Bias & 0.8539940\\
\bottomrule
\end{tabular}
\end{table}

\pagebreak

\hypertarget{regularization}{%
\section{Regularization}\label{regularization}}

We can see that in the previous RMSEs, \textcolor{red}{Movies Bias} and
\textcolor{red}{Users Bias} are not the best option, but the
\textcolor{red}{Users and Movies Bias} has the smallest RMSE. Is time to
identify if our previous analysis contains any error, we will start with
the \textcolor{red}{Movies Bias}. Let's see which is the result obtained
with first ten (10) movies, ordered in descendant mode.

\begin{table}[!h]

\caption{\label{tab:prediction.largest.errors.movies.bias}Largest Errors}
\centering
\begin{tabular}{lr}
\toprule
title & residual\\
\midrule
\rowcolor{gray!6}  Shawshank Redemption, The (1994) & \vphantom{9} -3.956928\\
Shawshank Redemption, The (1994) & \vphantom{8} -3.956928\\
\rowcolor{gray!6}  Shawshank Redemption, The (1994) & \vphantom{7} -3.956928\\
Shawshank Redemption, The (1994) & \vphantom{6} -3.956928\\
\rowcolor{gray!6}  Shawshank Redemption, The (1994) & \vphantom{5} -3.956928\\
\addlinespace
Shawshank Redemption, The (1994) & \vphantom{4} -3.956928\\
\rowcolor{gray!6}  Shawshank Redemption, The (1994) & \vphantom{3} -3.956928\\
Shawshank Redemption, The (1994) & \vphantom{2} -3.956928\\
\rowcolor{gray!6}  Shawshank Redemption, The (1994) & \vphantom{1} -3.956928\\
Shawshank Redemption, The (1994) & -3.956928\\
\bottomrule
\end{tabular}
\end{table}

We will reduce the repeated movies, to one, in order to identify the
mistakes in a better way. And, after joined the titles, the top Best
Movies Ratings, are:

\begin{table}[!h]

\caption{\label{tab:movies.top10.movies.rating}10 Best Movies Rating}
\centering
\begin{tabular}{lrr}
\toprule
title & b.i & n\\
\midrule
\rowcolor{gray!6}  Hellhounds on My Trail (1999) & 1.472996 & 1\\
Satan's Tango (SÃƒÂ¡tÃƒÂ¡ntangÃƒÂ³) (1994) & 1.472996 & 2\\
\rowcolor{gray!6}  Shadows of Forgotten Ancestors (1964) & 1.472996 & 2\\
Fighting Elegy (Kenka erejii) (1966) & 1.472996 & 2\\
\rowcolor{gray!6}  Sun Alley (Sonnenallee) (1999) & 1.472996 & 2\\
\addlinespace
Blue Light, The (Das Blaue Licht) (1932) & 1.472996 & 3\\
\rowcolor{gray!6}  Constantine's Sword (2007) & 1.472996 & 1\\
Human Condition II, The (Ningen no joken II) (1959) & 1.306330 & 6\\
\rowcolor{gray!6}  Who's Singin' Over There? (a.k.a. Who Sings Over There) (Ko to tamo peva) (1980) & 1.222996 & 4\\
Human Condition III, The (Ningen no joken III) (1961) & 1.222996 & 8\\
\bottomrule
\end{tabular}
\end{table}

And, finally, after joined the titles, the top 10 Worst Movies Ratings,
are:

\begin{table}[!h]

\caption{\label{tab:movies.10.worst.movies.rating}10 Worst Movies Rating}
\centering
\begin{tabular}{lrr}
\toprule
title & b.i & n\\
\midrule
\rowcolor{gray!6}  Besotted (2001) & -3.027004 & 2\\
Hi-Line, The (1999) & -3.027004 & 1\\
\rowcolor{gray!6}  Grief (1993) & -3.027004 & 1\\
Accused (Anklaget) (2005) & -3.027004 & 1\\
\rowcolor{gray!6}  War of the Worlds 2: The Next Wave (2008) & -2.777004 & 2\\
\addlinespace
SuperBabies: Baby Geniuses 2 (2004) & -2.713444 & 59\\
\rowcolor{gray!6}  Hip Hop Witch, Da (2000) & -2.693670 & 36\\
From Justin to Kelly (2003) & -2.597711 & 396\\
\rowcolor{gray!6}  Disaster Movie (2008) & -2.543133 & 31\\
Stacy's Knights (1982) & -2.527004 & 1\\
\bottomrule
\end{tabular}
\end{table}

Most of the movies rated as \textcolor{red}{Best Rated} and
\textcolor{red}{Worst Rated} are not popular, in recent years, and these
movies do not have to much ratings, so is required a better analysis. In
order of optimize \(b_{i}\) we use the follwing equation:
\[\frac{1}{N} \sum_{u,i} (y_{u,i} - \mu - b_{i})^{2} + \lambda \sum_{i} b_{i}^2\]\\
And, the same reduced equation is:

\[\hat{b_{i}} (\lambda) = \frac{1}{\lambda + n_{i}} \sum_{u=1}^{n_{i}} (Y_{u,i} - \hat{\mu}) \]

The regularization method allows us to add a lambd to penalizes movies
with large estimates from a small sample size.

In this graph, we can see the estimates shrink with penalty:

\begin{center}\includegraphics{img/movies.lambda.penalty-1} \end{center}


\end{document}
